<!DOCTYPE html>
<html id="html">

<head>
    <meta charset="utf-8">
    <title>Instagram image downloader</title>
    <link rel="stylesheet" href="../../styles/style.css">
    <script>
        function fetchImg(url) {
            url = addEmbed(document.querySelector('#insta_url').value)
            fetch(url)
                .then((response) => {
                    if (response.status == 404) {
                        alert("Url invalid! (Note: Private profiles not supported)")
                    }
                    return response.text();
                }
                ).then((page) => {
                    var parser = new DOMParser();
                    var fetchedDoc = parser.parseFromString(page, 'text/html');
                    var fetchedImg = fetchedDoc.documentElement.querySelector('.EmbeddedMediaImage');
                    var instaImg = fetchedImg.getAttribute('src')
                    document.querySelector("#guide").innerHTML = (`Right click below image and click 'Save image as...'`)
                    document.querySelector('#insta_image').setAttribute('src', instaImg)
                })
        }

        function addEmbed(url) {
            let index = url.indexOf("?")
            slicedUrl = url.slice(0, index)
            newUrl = slicedUrl.concat("embed")
            return newUrl
        }
    </script>
</head>

<body>
    <h1>Paste url below</h1>
    <input type="text" id="insta_url"
        placeholder="Eg., https://www.instagram.com/p/abcdefgh/?utm_source=ig_web_copy_link"
        style="width: 500px; text-align: center;">
    <br><br>
    <button onclick="fetchImg()">Get image</button>
    <button
        onclick="alert(`To get the url, go to desired post, click on ellipsis found on the top-right on the post and click on 'Copy Link'`)">Help</button>
    <br>
    <p id="guide" style="font-size: small;"></p>
    <br>
    <img id="insta_image" src="" width="500px" alt="instagram image will come here!">
</body>

</html>